# Serve the Vite-built SPA from dist/
RewriteEngine On

# Enforce a single canonical origin early to avoid mixed host/protocol redirects.
RewriteCond %{HTTPS} !=on [OR]
RewriteCond %{HTTP_HOST} !^european-alternatives\.cloud$ [NC]
RewriteRule ^ https://european-alternatives.cloud%{REQUEST_URI} [R=301,L]

# Allow API requests to execute PHP files directly.
# If the exact file exists (e.g. flags.json, .htaccess), serve it as-is.
RewriteCond %{REQUEST_URI} ^/api/ [NC]
RewriteCond %{REQUEST_FILENAME} -f
RewriteRule ^ - [L]

# Append .php extension for extensionless API paths (e.g. /api/catalog/entries â†’ entries.php).
RewriteCond %{REQUEST_URI} ^/api/ [NC]
RewriteCond %{REQUEST_FILENAME}.php -f
RewriteRule ^(.+)$ $1.php [L]

# Pass through remaining API requests (directories, 404s).
RewriteCond %{REQUEST_URI} ^/api/ [NC]
RewriteRule ^ - [L]

# Skip requests already targeting dist/
RewriteCond %{REQUEST_URI} ^/dist/ [NC]
RewriteRule ^ - [L]

# Serve existing files from dist/
RewriteCond %{DOCUMENT_ROOT}/dist%{REQUEST_URI} -f
RewriteRule ^ dist%{REQUEST_URI} [L]

# SPA fallback: all other routes serve dist/index.html
RewriteRule ^ dist/index.html [L]
